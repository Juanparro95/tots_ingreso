<div class="bg-gray-50 min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="mb-8 flex justify-between items-center">
      <div>
        <h1 class="text-4xl font-bold text-gray-800 mb-2">Mis Reservas</h1>
        <p class="text-gray-600">Gestiona todas tus reservas de espacios</p>
      </div>
      <button
        pButton
        label="Nueva Reserva"
        icon="pi pi-plus"
        (click)="newReservation()"
        severity="success"
        [style]="{'padding': '0.75rem 2rem'}"></button>
    </div>

    <!-- Reservations Table -->
    <p-card class="shadow-lg">
      <p-table
        [value]="reservations"
        [loading]="loading"
        [paginator]="true"
        [rows]="10"
        responsiveLayout="scroll"
        styleClass="p-datatable-striped"
      >
        <!-- Columns -->
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="event_name">Evento</th>
            <th pSortableColumn="space.name">Espacio</th>
            <th pSortableColumn="start_time">Fecha y Hora</th>
            <th>Duración</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-reservation>
          <tr>
            <td>
              <span class="font-semibold text-gray-800">{{ reservation.event_name }}</span>
            </td>
            <td>
              {{ reservation.space?.name }}
            </td>
            <td>
              {{ formatDateTime(reservation.start_time) }}
            </td>
            <td>
              {{ getReservationDuration(reservation.start_time, reservation.end_time) }}
              horas
            </td>
            <td>
              <p-tag [value]="getStatus(reservation.start_time)" [severity]="getStatusSeverity(reservation.start_time)" />
            </td>
            <td>
              <div class="flex gap-2">
                <button
                  pButton
                  type="button"
                  icon="pi pi-pencil"
                  (click)="editReservation(reservation)"
                  class="p-button-rounded p-button-info p-button-text"
                  pTooltip="Editar"
                  tooltipPosition="top"></button>
                <button
                  pButton
                  type="button"
                  icon="pi pi-trash"
                  (click)="cancelReservation(reservation.id!)"
                  class="p-button-rounded p-button-danger p-button-text"
                  pTooltip="Cancelar"
                  tooltipPosition="top"></button>
              </div>
            </td>
          </tr>
        </ng-template>

        <!-- Empty Message -->
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="6" class="text-center p-6">
              <i class="pi pi-calendar text-5xl text-gray-300 block mb-4"></i>
              <p class="text-xl text-gray-500">No tienes reservas aún</p>
              <p class="text-gray-400">
                <a (click)="newReservation()" class="text-indigo-600 hover:text-indigo-700 cursor-pointer font-medium">
                  Crea tu primera reserva
                </a>
              </p>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>

<!-- Edit Dialog -->
<p-dialog
  [(visible)]="editDialogVisible"
  [modal]="true"
  header="Editar Reserva"
  [style]="{ width: '500px' }"
>
  <form [formGroup]="editForm" class="space-y-4">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Nombre del Evento</label>
      <input pInputText formControlName="event_name" class="w-full" />
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-2">Notas</label>
      <textarea pInputTextarea formControlName="notes" class="w-full" rows="3"></textarea>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <button
      pButton
      label="Guardar"
      (click)="saveChanges()"
      [disabled]="editForm.invalid"
      icon="pi pi-check"></button>
    <button
      pButton
      label="Cancelar"
      (click)="editDialogVisible = false"
      severity="secondary"
      [text]="true"></button>
  </ng-template>
</p-dialog>
