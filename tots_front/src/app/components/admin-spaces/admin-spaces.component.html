<div class="page admin-spaces">
  <div class="container glass-card">
    <div class="toolbar">
      <div class="filters">
        <span class="field">
          <input pInputText [(ngModel)]="searchText" placeholder="Buscar" />
        </span>
        <span class="field">
          <p-inputNumber [(ngModel)]="minCapacity" [min]="0" [showButtons]="false" placeholder="Capacidad mínima"></p-inputNumber>
        </span>
        <span class="field">
          <p-inputNumber [(ngModel)]="maxCapacity" [min]="0" [showButtons]="false" placeholder="Capacidad máxima"></p-inputNumber>
        </span>
        <span class="field">
          <p-dropdown [options]="typeOptions" [(ngModel)]="selectedType" [showClear]="true" placeholder="Tipo" optionValue="value" optionLabel="label"></p-dropdown>
        </span>
        <button pButton type="button" class="p-button-sm" icon="pi pi-search" label="Filtrar" (click)="load()"></button>
      </div>
      <div class="actions">
        <button pButton type="button" class="p-button-primary p-button-sm" icon="pi pi-plus" label="Nuevo" (click)="openCreate()"></button>
      </div>
    </div>

    <!-- MC-Table placeholder: replace p-table with <mc-table> when MC Kit is installed -->
    <p-table [value]="spaces" [loading]="loading" responsiveLayout="scroll">
      <ng-template pTemplate="header">
        <tr>
          <th>Nombre</th>
          <th>Tipo</th>
          <th>Capacidad</th>
          <th>Ubicación</th>
          <th>Precio/Hora</th>
          <th style="width: 140px">Acciones</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-space>
        <tr>
          <td>{{ space.name }}</td>
          <td><span class="badge" [ngClass]="'badge-' + space.type">{{ space.type | titlecase }}</span></td>
          <td>{{ space.capacity }}</td>
          <td>{{ space.location }}</td>
          <td>{{ space.hourly_rate | number: '1.2-2' }}</td>
          <td class="row-actions">
            <button pButton type="button" icon="pi pi-pencil" class="p-button-text p-button-sm" (click)="openEdit(space)" title="Editar"></button>
            <button pButton type="button" icon="pi pi-trash" class="p-button-text p-button-sm" (click)="remove(space)" title="Eliminar"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>

    <p-dialog [(visible)]="dialogVisible" [modal]="true" [draggable]="false" [style]="{ width: '520px' }" [dismissableMask]="true" [closeOnEscape]="true" [breakpoints]="{'768px':'96vw'}" [maximizable]="false">
      <ng-template pTemplate="header">
        <div class="dialog-header">
          <span>{{ editing ? 'Editar Espacio' : 'Nuevo Espacio' }}</span>
        </div>
      </ng-template>
      <div class="form-grid">
        <div class="field">
          <label>Nombre <span style="color: #ef4444;">*</span></label>
          <input pInputText [(ngModel)]="form.name" placeholder="Ej: Sala Ejecutiva" />
        </div>
        <div class="field">
          <label>Tipo <span style="color: #ef4444;">*</span></label>
          <p-dropdown [options]="typeOptions" [(ngModel)]="form.type" placeholder="Seleccionar tipo" optionValue="value" optionLabel="label"></p-dropdown>
        </div>
        <div class="field">
          <label>Descripción</label>
          <input pInputText [(ngModel)]="form.description" placeholder="Descripción breve" />
        </div>
        <div class="field">
          <label>Capacidad <span style="color: #ef4444;">*</span></label>
          <p-inputNumber [(ngModel)]="form.capacity" [min]="1" [showButtons]="true" placeholder="Personas"></p-inputNumber>
        </div>
        <div class="field">
          <label>Ubicación <span style="color: #ef4444;">*</span></label>
          <input pInputText [(ngModel)]="form.location" placeholder="Ej: Piso 3, Ala Norte" />
        </div>
        <div class="field">
          <label>Imagen (URL)</label>
          <input pInputText [(ngModel)]="form.image_url" placeholder="https://..." />
        </div>
        <div class="field">
          <label>Precio por hora <span style="color: #ef4444;">*</span></label>
          <p-inputNumber [(ngModel)]="form.hourly_rate" [min]="0" [mode]="'decimal'" [minFractionDigits]="2" [maxFractionDigits]="2" [showButtons]="true"></p-inputNumber>
        </div>
      </div>
      <ng-template pTemplate="footer">
        <div class="dialog-actions">
          <button pButton type="button" class="p-button-text" label="Cancelar" (click)="dialogVisible=false"></button>
          <button pButton type="button" class="p-button-primary" label="Guardar" (click)="save()"></button>
        </div>
      </ng-template>
    </p-dialog>

  <p-confirmDialog></p-confirmDialog>
</div>
