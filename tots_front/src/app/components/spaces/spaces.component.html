<div class="page">
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1 class="title">Espacios Disponibles</h1>
      <p class="subtitle">Encuentra y reserva el espacio perfecto para tu evento</p>
    </div>

    <!-- Filters -->
    <div class="glass-card">
      <div class="filters">
        <div>
          <label class="field-label">Buscar</label>
          <input
            pInputText
            [(ngModel)]="searchText"
            placeholder="Nombre o descripción"
            class="w-full"
          />
        </div>
        <div>
          <label class="field-label">Capacidad Mínima</label>
          <p-inputNumber [(ngModel)]="minCapacity" placeholder="0" class="w-full"></p-inputNumber>
        </div>
        <div>
          <label class="field-label">Capacidad Máxima</label>
          <p-inputNumber [(ngModel)]="maxCapacity" placeholder="999" class="w-full"></p-inputNumber>
        </div>
        <div>
          <label class="field-label">Fecha de Disponibilidad</label>
          <p-calendar [(ngModel)]="selectedDate" (onSelect)="onDateChange()" dateFormat="dd/mm/yy" [showIcon]="true" placeholder="Seleccionar fecha" class="w-full"></p-calendar>
        </div>
        <div style="display: flex; align-items: flex-end">
          <button
            pButton
            label="Buscar"
            icon="pi pi-search"
            (click)="loadSpaces()"
            [loading]="loading"
            style="width: 100%"></button>
        </div>
      </div>
    </div>

    <!-- Spaces Grid -->
    <div class="grid">
      <div *ngFor="let space of spaces">
        <div class="space-card">
          <div class="image-placeholder">
            <i class="pi pi-building" style="font-size: 48px; color: #93c5fd"></i>
          </div>
          <div class="content">
            <h3 class="name">{{ space.name }}</h3>
            <p class="description">{{ space.description }}</p>

            <div style="display: grid; gap: 8px; margin-bottom: 12px">
              <div class="info-row">
                <i class="pi pi-users" style="color: #60a5fa"></i>
                <span>Capacidad: {{ space.capacity }} personas</span>
              </div>
              <div class="info-row">
                <i class="pi pi-map-marker" style="color: #60a5fa"></i>
                <span>{{ space.location }}</span>
              </div>
              <div *ngIf="space.type" class="info-row">
                <i class="pi pi-tag" style="color: #a78bfa"></i>
                <span class="badge" [ngClass]="'badge-' + space.type">{{ space.type | titlecase }}</span>
              </div>
              <div class="price-badge">
                <i class="pi pi-dollar" style="color: #34d399"></i>
                <span>{{ formatPrice(space.hourly_rate) }}</span>
              </div>
              <div *ngIf="selectedDate" class="availability-indicator" [ngClass]="getAvailabilityClass(space.id || 0)">
                <i class="pi pi-check-circle" style="font-size: 0.875rem"></i>
                <span>{{ getAvailabilityPercentage(space.id || 0) }}% disponible</span>
              </div>
            </div>

            <div class="actions">
              <button
                pButton
                type="button"
                label="Ver Detalles"
                icon="pi pi-info-circle"
                (click)="viewDetails(space)"
                class="action-btn"
                severity="info"
                [text]="true"></button>
              <button
                pButton
                type="button"
                label="Reservar"
                icon="pi pi-calendar"
                (click)="makeReservation(space)"
                class="action-btn"
                severity="success"></button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty state -->
    <div *ngIf="!loading && spaces.length === 0" class="empty">
      <i class="pi pi-inbox icon"></i>
      <p class="text">No se encontraron espacios</p>
    </div>
  </div>
</div>

<!-- Details Modal -->
<p-dialog
  [(visible)]="detailsVisible"
  [modal]="true"
  [header]="selectedSpace?.name"
  [style]="{ width: '800px' }"
>
  <div *ngIf="selectedSpace">
    <p-tabView>
      <p-tabPanel header="Detalles">
        <div style="display: grid; gap: 12px; padding: 20px 0">
          <div>
            <label class="dialog-label">Descripción</label>
            <p class="dialog-text">{{ selectedSpace.description }}</p>
          </div>
          <div>
            <label class="dialog-label">Capacidad</label>
            <p class="dialog-text">{{ selectedSpace.capacity }} personas</p>
          </div>
          <div>
            <label class="dialog-label">Ubicación</label>
            <p class="dialog-text">{{ selectedSpace.location }}</p>
          </div>
          <div>
            <label class="dialog-label">Tarifa por Hora</label>
            <p class="dialog-text" style="font-weight: 700; color: #34d399">{{ formatPrice(selectedSpace.hourly_rate) }}</p>
          </div>
        </div>
      </p-tabPanel>

      <p-tabPanel header="Disponibilidad">
        <app-space-availability-calendar
          [spaceId]="selectedSpace.id!"
          (timeSelected)="onTimeSelected($event)"
          style="display: block; padding: 20px 0">
        </app-space-availability-calendar>
      </p-tabPanel>
    </p-tabView>

    <ng-template pTemplate="footer">
      <button
        pButton
        label="Reservar Ahora"
        (click)="makeReservation(selectedSpace!)"
        icon="pi pi-calendar"></button>
      <button
        pButton
        label="Cerrar"
        (click)="detailsVisible = false"
        severity="secondary"
        [text]="true"></button>
    </ng-template>
  </div>
</p-dialog>
